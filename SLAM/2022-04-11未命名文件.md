---
title: 基于特征的slam框架
category: 2022-04
renderNumberedHeading: true
grammar_cjkRuby: true
---

# PTAM
## PTAM的创新性
1. 提出并实现了**跟踪**与**建图**过程的**并行化**，跟踪部分需要实时响应图像数据，而对地图的优化则没必要实时地计算。后端优化可以在后台慢慢进行，然后在必要的时候进行线程同步即可。 这是视觉SLAM中首次区分出前后端的概念，引领了后来许多视觉SLAM系统的设计（我们现在看到的SLAM多半都分前后端）。
2. 第一个使用 **非线性优化**，而不是使用传统的滤波器作为后端的方案。
3. 引入了关键帧机制不必精细地处理每一幅图像，而是把几个关键图像串起来，然后优化其轨迹和地图。早期的SLAM大多数使用EKF滤波器或其变种，以及粒子滤波器等；在PTAM之后，视觉SLAM研究逐渐转向了以非线性优化为主导的后端。由于之前人们未认识到**后端优化的稀疏性**，所以觉得优化后端无法实时处理那样大规模的数据，而PTAM则是一个显著的反例。

具体而言
**姿态跟踪线程** 不修改地图，只是利用已知地图来快速跟踪；
**地图线程** 专注于地图的建立、维护和更新。
优点 ： 即使建立地图线程耗时稍长，姿态跟踪线程仍然有地图可以跟踪（如果设备还在已建成的地图范围内）.
缺点： 如果地图建立或优化过慢，跟踪线程很容易会因为没有最新的地图或者没有优化过的地图而跟丢。
## 基于多线程的tracking和mapping策略




![enter description here](./images/1649656320827.png)
### tracking
#### - 构造图像金字塔
  金字塔分层以加快匹配同时提高地图点相对于相机远近变化时的鲁棒性
####  FAST特征提取
[参考文献](https://medium.com/data-breach/introduction-to-fast-features-from-accelerated-segment-test-4ed33dde6d65)
是一种角点检测算法，其主要优点是计算速度较快
![enter description here](./images/1649663013761.png)
其计算逻辑如下
1. 选择点p
2. 选择灰度阈值t与像素个数阈值n
3. 选择围绕p点的16个像素所构成的圈（半径为3的布雷森汉姆圈）
4. 如果这16个像素中有n个点的灰度值比p点大t或小t，那么这个点就是角点 \

其中有一些优化速度的步骤，先选择16个像素的1、5、9、13为比对点，若$n2$个像素比对阈值大于t则认为p点不是角点，否则则全部比对。
朴素的算法有一些缺点，其一是n=12（作者原方法参数）时，得到的p点非常多；其二是16个像素点的查询顺序决定了算法的速度。后续算法使用了机器学习方法进行改进。


机器学习方法改进
1. 选取一组训练图片集（最好来自最后要进行检测的图像的应用领域）
2. 在每一张图片上进行朴素FAST角点检测
3. 对每个角点，存储其周围16个像素，最终得到所有图片的特征向量p
   ![enter description here](./images/1649677043266.png)
4. 16个像素中的每个像素都有三种状态
	  ![enter description here](./images/1649675555934.png)
5. 根据这些状态，特征向量p可以被分为三个子集pd,ps,pb
6. 定义变量Kp，若p是角点则值为true，若p不是角点则为false
7. 使用决策树（ID3）查询使用变量 Kp 查询每个子集以获取关于真实类的知识

通常先提取出大量匹配点，后使用SSD快匹配，剔除误匹配

使用非最大值抑制进行特征点稀疏化



#### 地图初始化
对每帧图像提取出的FAST特征点，进行极大值抑制并且计算 Shi-Tomas得分，选出得分较高的特征点

- 跟踪定位
- 选取添加关键帧到缓存队列
- 重定位

#### 跟踪定位
##### 极线几何与极线搜索
![enter description here](./images/1649900043648.png)
有时我们使用一个相机进行拍摄目标时，会发现几个物体都重合了，但是当我们再放台相机的时候，就可以把这些物体特征获取到。
也就是双目视觉的对应关系，同时可以用于相邻两帧之间的运动估计。
##### 极线几何(Epipolar geometry)基本概念
![enter description here](./images/1649900609066.png)
- （匹配） 极线约束：匹配点必须在极线上
- 基线：左右相机光心连线
- 极平面：空间点，两相机光心决定的平面
- 极点：基线与两相机图像平面的交点
- 极线：极平面与图像平面的交线

##### 本质矩阵

### mapping
- 局部BundleAdjustment
- 全局BundleAdjustment
- 从缓存队列取出关键帧到地图
- 极线搜索加点到地图

## 与一般SLAM框架共有的环节
- 传感器数据获取（摄像头输入图像数据）
- 前端视觉里程计（跟踪定位、重定位）
- 后端优化（Bundle Adjustment）
- 建图（极线搜索加点）
- 没有回环检测

# 
- 关键帧的发展道路
- Mapping仅处理关键帧
- 局部光束法平差（Boundle Adjustment）来优化路标点与相机位姿
- 
