# 基础矩阵、本质矩阵和单应矩阵的求解过程 
2023-11-23

## Ax=b
$Ax=b$的求解方法分为基于代数误差的线性估计和基于几何误差的非线性估计

## DLT

直接线性变换指将对应矩阵看作向量，通过构建$Ax=b$的系统，之后求解该向量的线性方程组来恢复对应矩阵，求解线性方程组一般通过SVD分解的方式。

在进行直接线性变换时，为了消除坐标系和减少数值误差带来的影响，要对点坐标进行归一化。
1. 对点进行平移使其形心位于原点
2. 对点进行缩放使他们到原点的平均距离等于$\sqrt{2}$
3. 对两幅图独立进行上述变换

## 非线性优化

构建代价函数进行非线性最小二乘方法优化


## 单应矩阵
已知
$$p_2=K(RP+t)$$
设$P$处于平面$n^TP+d=0$上，则有$1=-\cfrac{n^TP}{d}$，则有：

$$p_2=K(R+-\cfrac{tn^T}{d})P=K(R+-\cfrac{tn^T}{d})K^{-1}p_1$$
则有单应矩阵：
$$Hp_1=p_2$$
此处是齐次矢量方程，等号左右两边向量具有相同方向，但是大小上可能相差一个常数系数


### DLT
1. 通过$p_2\times{}Hp_1=0$构建$Ah=0$求解
2. 直接整理$Hp_1=p_2$构建$Ah=b$求解

## 基础矩阵和本质矩阵
已知：
$$sp_2=K(RK^{-1}p_1+t)$$
的：
$$t\times{}K^{-1}sp_2=t\times{}RK^{-1}p_1$$
已知$t\times{}K^{-1}sp_2$是垂直于$t$和$K^{-1}sp_2$的向量，则：
$$sp_2^TK^{-T}t\times{}K^{-1}sp_2=sp_2^TK^{-T}t\times{}RK^{-1}p_1=0$$
$s$为常数可以约去
定义本质矩阵：
$$E=t\times{}R$$
基础矩阵：
$$F=K^{-T}EK^{-1}$$
同样可以通过$p_2^TFp_1=0$构建$Af=0$或者$Ae=0$进行直接线性变换求解

在分解到单应矩阵时，由$Af=0$分解得到的$\hat{F}$并不是真正的$F$，分解得到的结果满秩，但是$F$秩为2，需要进一步计算
$$\left\|F-\widehat{F}\right\|_{F}\quad\quad{\mathrm{s.t.~det}(F)=0}$$
计算方法为：
$$SVD\big(\hat{F}\big)=U\begin{bmatrix}s_1&0&0\\0&s_2&0\\0&0&s_3\end{bmatrix}V^T\implies F=U\begin{bmatrix}s_1&0&0\\0&s_2&0\\0&0&0\end{bmatrix}V^T$$
### 分解R，t
在求得$E$后，通过SVD分解求得R和t
$$E=U\Sigma V^{T}$$
确定平移和旋转
$$\begin{aligned}\bullet&\quad R=UV^T\\\bullet&\quad R=UW^TV^T\end{aligned}$$
而$t=u_3$或$t=-u_3$
$u_3$代表$U$的第三列
将点带入后，正确的解组合应当是点集具有正的深度

