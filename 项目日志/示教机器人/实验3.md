---
title: 机器人实验（3）
renderNumberedHeading: true
grammar_cjkRuby: true
---

# 实验任务
实验过程分共10’，分为以下几个任务。
- 编译示例程序并运行（1’）
- 编写代码获取机器人状态（4’）
	- 各轴角度（原始）（1‘）
	- 各轴角度（调零）（1‘）
	- 各轴速度（1‘）
	- 各轴力矩（1‘）
- 编写代码调用关节插补实现各轴运动（4‘）
- 编写代码调节控制夹爪张合（1’）

# 实验过程（10’）
## 编译示例程序并运行（1’）
### 编译程序（0.5‘）
在上个实验指导书中已经说明了项目编译环境的安装步骤，并将本地一个文件夹共享给了编译环境（ubuntu14）的某个目录，现在将示例代码复制到本机的共享目录中，并进入项目根目录，使用下面的指令进行编译。

``` bash
g++ -o rbt.out rbt.cpp general_6s.cpp general_6s.h project_base/* -lrt -lpthread -std=c++11 -m32
```

### 编译结果的运行（0.5‘）
将编译后的结果使用`scp`命令传到机器人控制器下的`~/robot/`目录下，并使用下面的命令执行程序。
``` bash
sudo ./rbt.out -f eni/robot.xml
```
程序将输入下面的内容。
``` bash
请输入控制字：
```
输入
```bash
hello
```
可见机械臂平台上距离机械臂较近的灯闪烁一下，程序即运行成功。

## 编写代码获取机器人状态（4’）
### 各轴角度（原始）（1‘）
```c++
// 获取第一轴原始角度的示例代码
g_general_6s->get_actual_position(0);
```

在运行程序后，目标调试信息如下,其中第一个`print_joints_deg`为用户输入：

``` bash
请输入控制字：
print_joints_deg
执行任务：print_joints_deg
各轴初始角度
第1轴原始角度为：13.170844
第2轴原始角度为：-17.725897
第3轴原始角度为：-81.124404
第4轴原始角度为：0.091239
第5轴原始角度为：106.324027
第6轴原始角度为：140.387628
```

### 各轴角度（调零）（1‘）
调零角度计算公式为：
$$调零角度 = （初始角度 - 初始偏置） * 机械臂物理方向$$
- 初始偏置：`joint_bias`
- 机械臂物理方向：`joint_direction`

在运行程序后，目标调试信息如下,其中第一个`print_joints_zero_deg`为用户输入：
``` bash
请输入控制字：
print_joints_zero_deg
执行任务：print_joints_zero_deg
各轴调零角度
第1轴调零角度为：0.024544
第2轴调零角度为：-0.018703
第3轴调零角度为：0.043596
第4轴调零角度为：-0.091239
第5轴调零角度为：0.003527
第6轴调零角度为：-0.023628
```

### 各轴速度（1‘）
使用差分做速度

在运行程序后，目标调试信息如下,其中第一个`print_joints_velocity`为用户输入：
``` bash
请输入控制字：
print_joints_velocity
执行任务：print_joints_velocity
各轴速度
第1轴速度为：0
第2轴速度为：0
第3轴速度为：0
第4轴速度为：0
第5轴速度为：0
第6轴速度为：0

```


### 各轴力矩（1‘）	
```c++
// 获取第一轴力矩的示例代码
int i = 0;
joints_rated_torque[i] * joints_reduce_ratio[i] * g_general_6s->get_actual_torque(i) / 1000.0 / 1000.0;
```

在运行程序后，目标调试信息如下,其中第一个`print_joints_effort`为用户输入：
``` bash
请输入控制字：
print_joints_effort
执行任务：print_joints_effort
各轴力矩
第1轴力矩为：0
第2轴力矩为：0
第3轴力矩为：-0.0812314
第4轴力矩为：0
第5轴力矩为：0.0775125
第6轴力矩为：0

```

## 编写代码调用关节插补实现各轴运动

机械臂移动的示例代码已经在函数`joint_move`中给出，需要按照上述逻辑编写函数
- joint1_add10_then_zero
- joint2_add10_then_zero
- joint3_add10_then_zero
- joint4_add10_then_zero
- joint5_add10_then_zero
- joint6_add10_then_zero